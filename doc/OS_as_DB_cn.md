# 未来的OS内核将是一个面向数据的调度器（带有计算机硬件和软件集成架构图）

---- 未来OS将是一个类似DB的ASIC系统, Clojure则是最好的DML

版权所有 © 2021.11.15 林鹏程， 保留所有权利。

在未来, OS将面临如下挑战:

- 采用仓库/车间模型的做为硬件架构的计算机越来越多, 从SOC到超级计算机，从单机到云计算， 需要支持数量和种类都非常众多的计算单元（如CPU, GPU, ASIC等）。

- 在物联网时代，计算机将要连接越来越多硬件.

- 海量的应用程序

这种发展趋势, 需要对 OS 的算法进行改进:

- 如果一个工厂(计算机系统)只有一个车间(CPU), 那么, 由车间(CPU)自行管理原料(数据)更高效.

- 如果一个工厂(计算机系统)有非常多个且不同种类的车间(CPU,GPU, ASICs, 应用程序, 服务程序), 
  那么,由一个专门的管理部门(仓库, 数据库)管理原料(数据)更为简单和高效, 这种方法可以更简单地进行异构并行计算, 
  更方便调度器进行全局优化, 更高效地进行数据交换, 提高总体资源效率, 获得的效益超过了所增加的数据管理成本.

OS应该发展成什么模样才能适应这种新的理论和新的计算机架构的发展潮流?
它必需采用如下仓库/车间模型:

- 仓库 

  - 内存: 存储数据, 各种资源的控制信息.
  
  - OS: 调度器,内存管理, 相当于DB引挚.
  
    - 目前,用CPU引导进入OS, 然后OS获得全面调度能力(包括CPU), OS的调度能力需要CPU执行. 
    
    - 未来, 如果能有一个ASIC取代CPU去配合OS会更好, 因为这个车间高频使用和重要, 已经有必要成为一个独立的内部(集成)车间.
      该 ASIC 主要负责调度和内存管理(OS内核也只有这些功能)，所有内部(集成)车间会都与内存直接连接。车间彼此独立, 不互相连接。
      不重要，很少使用，缓慢的外部车间可以使用总线。但是，车间仍不应相互连接。

  - DML: 只要让Clojure集成JDBC和SQL，让所有核心API原生支持JDBC和OSDB, 就可以立刻成为最好的DML.
    - 在应用层和脚本层，Clojure 或 Babashka 足够了。
    - 在系统层，如果需要，为一种编程语言实现原生编译器根本不是问题。此外，JVM 还拥有 GraalVM 来支持原生编译。
      - [Jank](https://github.com/jank-lang/jank)：在 LLVM 上托管的本地 Clojure 方言
      - [ClojuRust](https://github.com/clojurust/clojurust)：Clojure 有一个 Rust 实现
  
- 车间
  - 硬件: CPU，GPU, ASIC, 各种外设等
  - 软件: 各种应用程序, 服务程序

备注

- 车间之间的互连太过复杂和混乱.我以前写[一篇文章批评过这类技术(AMD Infinity Fabric Architecture)](./Intel_RISC_V.md).
  从AMD的文章的示意图中，AMD以Infinity Fabric总线为中心， 实现CPU-CPU之间的任务转移，
  未来打算实现GPU-GPU，CPU-GPU之间的任务转移， 即车间之间的互联，我在制造工业内，还未见到过这种车间任意互联的架构。 
  这是个网状结构，非常混乱和复杂，扩展性差，灵活性差，数据利用效率差。 
  我认为它在同类处理器之间的任务转移相对容易， 在不同类处理器之间的任务转移是复杂和困难的，效果也不会太好。 
  我认为它远远不如我的仓库/车间模型简单、可靠、灵活、扩展性强， 以仓库（数据）为中心，数据存取效率高，
  大致类似我以前发的[微软数据工厂/管道架构和仓库/车间模型的比较](./diff_WWModel_AzureDataFactoryPipe_cn.md)
  实际上,尽管Apple M1尚未完全实现仓库/车间模型，但它已经是第一名了。
  
- 在[为什么我的"仓库/车间模型"能做到高性能低功耗(以Apple, Intel, 高通为例)](./why_wwmodel_fast.md)中,
  "仓库/车间模型"源自制造工业的大工业生产,最适合大批大量高负载的大规模异构并行计算场景. 
  虽然当它应用在 Apple M1 芯片时, M1 不仅成为世界上最快的芯片,而且保持极低的功耗. 
  但实际上它的最佳应用场景是超级计算机或云计算, Apple M1 芯片的小身板不能发挥出它的优越性, 
  只是开席前的小菜一碟。

  为什么"仓库/车间模型"能做到高性能低功耗呢?这就是在大工业规模生产和任务分工的优点在计算机领域的展现. 
  另外以仓库为中心，数据存取和交换性能高. 统一调度，全局统筹优化效果好。

  如果一项任务独立作为一个车间后, 它产生的规模效益超过开设它的成本, 那么应该把它设立为一个车间, 
  注意: 在超过一定生产规模(计算量),专业车间的生产成本(功耗)较低且生产效率(性能)更高.

  对于计算机SOC芯片，它的空间很有限，不象软件项目那样增加车间的成本很低， 
  很有必要把车间分为内部（集成）车间和外部车间，只要所增加的专用核心（ASIC,专业车间）足够常用,
  产生的整体效益超过把这部分空间用来做通用核心(CPU,通用车间)的效益时, 可以把该专用核心（ASIC,专业车间）加入SOC芯片，
  成为内部车间. ASIC具有体积更小、功耗更低、可靠性更高、性能更高、保密性更强、成本更低等优点。
  
- Apple M1 统一内存架构（发布于 2020 年 11 月 11 日）就是我的"仓库/车间模型"（硬件架构部分发布于 2019 年 2 月 6 日），
  它是一个由数学模型支持的架构，与传统的、数学模型支持的"冯·诺伊曼架构"不同。  

参考 

- [一个在reddit的r/programming的很精彩的讨论](https://www.reddit.com/r/programming/comments/quk3xq/in_the_future_os_will_be_a_db_and_clojure_will_be/)

- [基于数学的大统一编程理论：纯函数管道数据流和基于原则的仓库/车间模型](https://github.com/linpengcheng/PurefunctionPipelineDataflow)

  它的数学原型是简单的、经典的、在社会生产实践中广泛应用的小学数学的“水池进排水问题”， 
  它以简单和统一的方式完美地、全面地把计算机理论与数学关联在一起: 
  从硬件集成电路和计算机架构, 到软件编程方法学、架构、编程语言等. 
  解决了IT业从诞生至今一直存在的根基科学性的根本问题----核心缺乏数学依据。

- [在hash-map(NoSQL)的基础上实现关系式数据模型和编程](./relational_model_on_hashmap.md)

- [一切都是RMDB](./Everything_is_RMDB.md)

- [Clojure是基于关系式数据库理论的函数式编程语言](./Clojure_is_FP_based_on_RMDB.md)

- [Foxpro面向数据库的编程范式是未来编程语言的发展方向(2021.11.07)](./Mummy4Foxpro.md)

- [为什么我的"仓库/车间模型"能做到高性能低功耗(以Apple, Intel, 高通为例)](./why_wwmodel_fast.md)

- [仓库/车间模型和微软Azure数据工厂/数据管道架构的区别](./diff_WWModel_AzureDataFactoryPipe.md)

- [评论: Intel, RISC-V, and AMD Infinity Fabric Architecture](./Intel_RISC_V.md)

![OS-Star-WWM](./image/OS-Star-WWM.svg)
  
