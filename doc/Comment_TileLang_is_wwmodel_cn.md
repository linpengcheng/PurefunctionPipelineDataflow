评论: DeepSeek-V3.2背后的国产算子编程语言TileLang努力趋向仓库/车间模型

版权所有 © 2025.10.01 林鹏程，保留所有权利。

从[《DeepSeek-V3.2背后的国产算子编程语言TileLang是什么？如何保持性能领先的同时减少6倍代码量？》](https://www.51cto.com/article/826597.html)
上看，他努力趋向仓库/车间模型。根据原文评价：

- 它把数据流编程范式自动转换为传统编程范式的机器码，并带有自动调度能力。
  
  > “TileLang是由北京大学计算机学院杨智副教授团队主导开发的一款开源AI算子编程语言，其核心价值在于能够将高级别的数据流描述，
  > 自动转换并优化为高效的底层代码（如CUDA或AscendC）。通过独特的Tile级抽象和自动调度能力，开发者可以用更简洁的代码表达复杂计算，
  > 同时获得接近手写算子的高性能，显著提升了AI算子的开发效率。” 

- 因为它要面对现在计算机的现实情况并不是统一内存，需要充分利用一切可用资源。

  > “"Tile"一词在高性能计算中指计算分块，这是优化内存层次结构利用的关键技术。无论是CPU的缓存系统，
  > 还是GPU的共享内存/寄存器层次，合理的Tiling策略都是实现高性能计算的必要条件。” 

- 它需要根据类似ERP(企业资源计划）和制造执行系统（MES，Manufacturing Execution System）的思想，
  通过实现抽象级的、虚拟的统一内存（仓库）和全局统一调度，成为一个标准的仓库/车间模型，
  如果再严格限制为管道数据流形式，并遵守10原则，编程会更简单、统一、高效，更强的并行能力。

  > “内存层次优化：TileLang允许开发者精确控制数据在内存层次结构中的流动，例如将数据缓存到寄存器进行反量化后再写入共享内存，
  > 或是直接写回共享内存。这种灵活性使得专家开发者能够针对特定硬件特性进行深度优化。” 

- 计算机软硬件都是制造数据的工厂，数据流是最好的统一抽象对象, 这是数据流的优点。

  > “TileLang的核心技术优势源于其统一的Tile级抽象。在高性能计算中，Tiling（分块）是优化数据局部性、提升缓存利用率的关键技术。
  > TileLang将这一概念从简单的循环分块提升为一级语言抽象，使开发者能够以数据流为中心描述计算，而不必过多关注硬件细节。” 


- 在现代工业的仓库里，不同的存货有不同的存储要求，划区布局是常规管理手段。

  > “布局推理（Layout Inference）：TileLang引入了一套完整的布局推理系统，用于描述数据在内存中的组织和映射方式。
  > 这一系统包括严格布局推理（针对矩阵乘等有强布局约束的算子）和通用布局推理（用于推导相连表达式的布局），
  > 使得编译器能够自动确定最优的内存布局。”

- 它用编译器实现“仓库/车间模型”的调度功能，调度车间（线程）完成任务。

  > “并行度推理：通过T.Parallel等原语，编译器能够自动推导出适合目标硬件的并行策略，包括线程绑定、向量化优化等。
  > 例如，给定kernel上下文128个线程，将Copy操作用T.Parallel包装后，编译器能够自动推导出高性能形式，
  > 最终Codegen成优化的CUDA代码。” 

- 从代码示例来看(本文代码太简略, 参照另外一些其他文章的代码)，它没实现管道风格的数据流，照顾了传统的编程习惯，
  我认为增加了并行度推理和调度的难度，降低了优化效果。用编译器和减少应用范围来给编程人员不科学的编程范式买单。
  它通过T.pipelined显式软件定义流水线 (Software Defined Pipeline) ，用数据流中心的操作符
  T.copy, T.gemm, T.reduce 等操作符定义了“做什么”（what），即数据瓦片之间的转换关系。而“怎么做”（how），
  即如何并行、如何布局，则由调度策略决定。把T.pipelined显式软件定义流水线包括在@T.prim_func函数里, 
  看起来象纯函数(管道),T.pipelined这部分的写法有点接近我的clojure代码写法, 但真的很丑啊!
  可能是因为更多地面向底层机器层所致. 考虑了太多的具体的机器操作, 
  可以在这上面实现更高层的抽象语言, 实现更简单的统一的自动仓库管理和车间(线程, 机器层)的调度，
  代码会更象是声明式语言，编程更简单，代码风格更漂亮。

  
